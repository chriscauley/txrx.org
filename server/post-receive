#!/bin/bash

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
export PROJECT_ROOT=$DIR/../../

#for now just update lablackey every time.
cd /home/django/lablackey
echo `pwd`
git pull

#same for riot-comments
cd /home/django/django-riot-comments
git pull

GIT_WORK_TREE=$PROJECT_ROOT../ git checkout -f

cd $PROJECT_ROOT

echo -e "\n---Silently migrating, compressing, collecting static, and restarting---\n"

python $PROJECT_ROOT/manage.py migrate>/dev/null
python $PROJECT_ROOT/manage.py collectstatic --noinput>/dev/null
python $PROJECT_ROOT/manage.py compress>/dev/null

bash $PROJECT_ROOT/server/uwsgi.sh
