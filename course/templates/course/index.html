{% extends "base.html" %}
{% load thumbnail %}

{% block title %}Classes {{ term.name }}{% endblock %}
{% block header %}{% endblock %}

{% block head %}
<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.5/angular.min.js"></script>
<script src="{{ STATIC_URL }}js/ng-infinite-scroll.js"></script>
{% endblock %}
{% block extrajs %}
<script>
var myApp = angular.module('myApp', ['infinite-scroll']);

myApp.controller('DemoController', function($scope) {
  $scope.courses = [
    {% for course in courses %}{{ course.dumps_json|safe }}{% if not forloop.last %},{% endif %}{% endfor %}
  ]

  $scope.open_courses = $scope.courses.slice(0,10);
  $scope._vi = 10;
  $scope.loadMore = function() {
    if ($scope._vi == $scope.courses.length) {return }
    $scope.open_courses = $scope.courses.slice(0,$scope.open_courses.length+6);
    $scope._vi = $scope.open_courses.length
    console.log($scope._vi);
  };
});

/*var ngTXRX = angular.module('ngTXRX',['infinte-scroll']).config(function($interpolateProvider){
    $interpolateProvider.startSymbol('[[').endSymbol(']]');
});

ngTXRX.controller('CourseController', function($scope) {
});*/
</script>
{% endblock %}

{% block main %}
<div class="col-xs-12">
  <h1 class="page_title">
    {{ term.name }} Classes
    <div class="calendar_widget">
      <a href="javascript:;" onclick="$('.add_to_calendar').toggle()">
        <span class="glyphicon glyphicon-calendar"></span></a>
      {% include "course/_add_to_calendar.html" with calendar_event=occurrence calendar_context="classes" %}
    </div>
  </h1>
</div>
<div style="clear:both;"></div>
<div class="col-sm-6 col-md-4 col-lg-3" id="side">
  <input type="checkbox" id="toggle_filters" />
  <label for="toggle_filters" class="btn btn-success">Filter by Subject</label>
  <form onsubmit="applyFilters(this);return false;" class="filters course_filters">
    <input name="q" class="form-control" placeholder="Search Classes">
    {% include "course/_filters.html" %}
  </form>
</div>
<div class="col-sm-6 col-md-8 col-lg-9">
  <ul class="nav nav-tabs" role="tablist">
    <li class="active"><a href="#all_classes" role="tab" data-toggle="tab">All Classes</a></li>
    <li><a href="#my_classes" role="tab" data-toggle="tab">My Classes ({{ user_sessions|length }})</a></li>
    {% if instructor_sessions %}
    <li><a href="#instructor_sessions" role="tab" data-toggle="tab">
        Instructor ({{ instructor_sessions|length }})</a></li>
    {% endif %}
  </ul>
  <div class="tab-content">
    <div class="tab-pane active" class="course_list">
      <div ng-app='myApp' ng-controller='DemoController'>
        <div infinite-scroll='loadMore()' infinite-scroll-distance='2'>
          <div class="row">
            <div ng-repeat='course in open_courses track by $index'>
              {% include "course/_course_row.html" %}
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="tab-pane" id="my_classes">
      {% if request.user.is_authenticated %}
      {% include "course/_myclasses.html" %}
      {% else %}
      <p class="alert alert-error">
        Already signed up?
        <a href="/accounts/login/?next={{ request.path|urlencode }}{{ "#my_classes"|urlencode }}">Log in</a>
        to see your classes.<br />
        If not, an account will be automatically created when you first pay for a class.
      </p>
      {% endif %}
    </div>
    {% if instructor_sessions %}
    <div class="tab-pane" id="instructor_sessions">
      <ul>
        {% for session in instructor_sessions %}
        <li>
          <a href="{% url "course:instructor_session" session.pk %}">
            {{ session.section.course.name }}
          </a>
          <br />
          {{ session.get_short_dates }}
          <br />
          ({{ session.total_students }}/{{ session.section.max_students }} students)
          <br />&nbsp;
        </li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
