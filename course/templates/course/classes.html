{% extends "base.html" %}
{% load url from future %}
{% load thumbnail content_tags %}

{% block title %}Classes {{ term.name }} at {{ block.super }} {% endblock %}

{% block extra_head %}
<script type="text/javascript">
function expand(that) {
  $(that).closest('.row').toggleClass('expanded');
  return false;
}
</script>
{% endblock %}

{% block main %}
{% if "success" in request.GET %}
<b>
  You have been enrolled in your classes.
  {% if not request.user.is_authenticated %}
  <br />
  If you haven't already, please click
  <a href="/password-reset/recover/">reset your password</a>.
  <br />
  Otherwise click please <a href="/accounts/login/">log in</a>.
  {% endif %}
</b>
{% endif %}
{% include "widgets/filters.html" %}
<h1>Classes for {{ term.name }}</h1>
<div id="courses">
  <div class="row th">
    <div class="name">Class Name</div>
    <div class="instructor">Instructor</div>
    <div class="first_date">First Date</div>
    <div class="intro">Intro Level?</div>
    <div class="days">Days</div>
    <div class="cost">Cost</div>
    <div class="fee"></div>
  </div>
  {% for session in sessions %}

  {% ifchanged session.week %}
  <div class="row month">
    <div colspan="8" style="padding: 25px 0 5px;">
      Classes starting {{ session.week.0 }} - {{ session.week.1 }}
    </div>
  </div>
  {% endifchanged %}

  <div id="c{{session.id}}" class="row course filterable {% cycle row1,row2 %}"
       data-subject="{% for subject in session.subjects %}{{ subject }},{% endfor %}"
       {%if not session.course.closed%}data-open{%endif%}
       data-date="{{ session.starttime|date:"Ymd" }}">
    {% if request.user.is_superuser %}
    <a href="{{ request.path }}#c{{ session.id }}" class="anchor"></a>
    {% endif %}
    <div class="name">
      <a href="{% url "course:detail" session.slug %}">
	{{ session.section.course }}
      </a>
    </div>
    <div class="instructor">{% if session.user.first_name and session.user.last_name%}
      {{ session.user.first_name }} {{ session.user.last_name|slice:":1" }}.{% else %}
      {{ session.user.username }}{% endif %}
    </div>
    <div class="first_date">{{ session.classtime_set.all.0.start|date:"F j" }}</div>
    <div class="intro">
      {% if session.section.prerequisites or session.section.requirements %}
      <a href="javascript:;" onclick="return expand(this);" class="showDetails">No (details)</a>
      {% else %}
      Yes
      {% endif %}
    </div>
    <div class="days">{{ session.classtime_set.count }}</div>
    <div class="fee">
      <span class="item_price">
        {{ session.section.fee }}{% if session.section.fee_notes %}*{% endif %}
      </span>
    </div>
    {% include "course/_enroll_link.html" %}
    <div class="details">
      <div class="left">
	<div class="subjects">
	  <b>Subject{% if session.section.course.subjects.count > 1 %}s{% endif %}</b>:
	  {% for subject in session.section.course.subjects.all %}
	  {{ subject }}{% if not forloop.last %}, {% endif %}
	  {% endfor %}
	</div>
	<ol class="dates">{% for classtime in session.classtime_set.all %}
	  <li>
	    {{ classtime.start|date:"D m/d G:i" }}
	    -
	    {{ classtime.end_time|time:"G:i" }}
	  </li>{% endfor %}
	</ol>
      </div>
      <div class="right">
	<div class="description">
	  {{ session.section.description|linebreaksbr }}
	</div>
	{% if session.section.fee_notes %}
	<span class="notes">* {{ session.section.fee_notes }}</span>
	{% endif %}
	{% if session.section.requirements %}
	<span class="notes">
	  <b>Requirements:</b> {{ session.section.requirements }}
	</span>
	{% endif %}
	{% if session.section.prerequisites %}
	<span class="notes">
	  <b>Prerequisites:</b>
	  {{ session.section.prerequisites }}
	</span>
	{% endif %}
      </div>
      <div style="clear: both;"></div>
    </div>
  </div>
  {% endfor %}
</div>
{% include "course/_cart.html" %}
{% endblock %}
