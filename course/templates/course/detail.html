{% extends "base.html" %}
{% load mptt_comments_tags %}

{% block title %}{{ session.section.course }}{% endblock %}
{% block header %}{% endblock %}

{% block content %}
<div class="page-header" style="margin: -10px 0 20px;">
  <h1 class="home-tagline">{{ session.section.course }}</h1>
</div>
<div class="course" data-subject="{{ session.subjects|join:"," }}"
     {%if not session.course.closed%}data-open{%endif%}
     data-date="{{ session.starttime|date:"Ymd" }}">
  <div class="instructor">
    Taught by
    {% if session.user.first_name and session.user.last_name %}
    {{ session.user.first_name }} {{ session.user.last_name|slice:":1" }}.{% else %}
    {{ session.user.username }}{% endif %}
  </div>
  <div class="fee">
    {% include "course/_enroll_link.html" %}
    (${{ session.section.fee }}{% if session.section.fee_notes %}*{% endif %})
  </div>
  <div class="details">
    <div class="left">
      <div class="subjects">
	<b>Subject{{ session.section.course.subjects|pluralize:"s" }}</b>:
	{{ session.section.course.subjects.all|join:"," }}
      </div>
      <ol class="dates">{% for classtime in session.classtime_set.all %}
	<li>
	  {{ classtime.start|date:"D m/d G:i" }}
	  -
	  {{ classtime.end_time|time:"G:i" }}
	</li>{% endfor %}
      </ol>
    </div>
    <div class="right">
      <div class="description">
	{{ session.section.description|linebreaksbr }}
      </div>
      {% if session.section.fee_notes %}
      <span class="notes"><b>* Fee Notes:</b> {{ session.section.fee_notes }}</span>
      {% endif %}
      {% if session.section.requirements %}
      <span class="notes">
	<b>Requirements:</b> {{ session.section.requirements }}
      </span>
      {% endif %}
      {% if session.section.prerequisites %}
      <span class="notes">
	<b>Prerequisites:</b>
	{{ session.section.prerequisites }}
      </span>
      {% endif %}
    </div>
    <div style="clear: both;"></div>
    {% display_comment_toplevel_for session %}
  </div>
</div>
{% endblock %}

{% block side %}
{% if request.user == session.user or request.user.is_superuser %}
<h2>Instructor Panel</h2>
<div class="accordion" id="instructor_panel">
  <div class="accordion-group">
    <div class="accordion-heading">
      <a class="accordion-toggle" data-parent="#instructor_panel"
         data-toggle="collapse" href="#student_list">
        Student List ({{ session.enrollment_set.count }} students)
      </a>
    </div>
    <div id="student_list" class="accordion-body collapse in">
      <div class="accordion-inner">
        <ul>
          {% for enrollment in session.enrollment_set.all %}
          <li>{{ enrollment.user.email }}</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</div>
{% else %}
{% include "course/_cart.html" %}
{% endif %}
{% endblock %}
